---
title: vue, nuxt 의 modern mode 톺아보기
date: 2021-12-12 20:09:03
tags: [nuxt, modern, vue]
---

Frontend 와 Backend 의 가장 큰 차이점은 런타임 환경의 제어가 어렵다는게 아닐까 싶습니다.

물론 브라우저 종류, 버전에 따라 거를 수 도 있겠지만, 어지간 해서는 그럴 일은 없을거라 생각됩니다. ~~IE9 만 지원하는 페이스북, Chrome 96만 지원하는 깃헙이라니 생각만 해도 벌써 정신이 아득해지는것 같습니다.~~

군, 병원 등의 인트라넷 백오피스 같이 특수한 경우라면 모르겠지만, 사용자에게 특정 환경을 강요할 수 없는 **대다수 서비스의 프론트엔드는 가능한 다양한 환경에서 동작할 수 있게 해야 합니다.**

**그리고 이 시점에서 이 글의 주제가 시작됩니다.**

<!-- more -->

최근의 프론트엔드는 Vue, React, Angular, Svelte 등 다양한 프레임워크, 라이브러리와 함께합니다.

여기에 우리는 타입 스크립트도 끼얹고 es5부터 es2021까지 다양한 문법을 사용하지만 우리는 이 문법들을 사용자 브라우저에서 이해할까 라는 고민을 하지 않습니다.

나왔으니 사용하고 빌드해서 올리면 당연히 브라우저에서 돌아가는것으로 인지합니다.

그런데 위에서 얘기했듯이 대다수의 프론트는 코드가 실행될 환경을 제어할 수 없습니다.

브라우저별, 버전별로 지원하는 문법이 다르고 최종 사용자가 어떤 브라우저로 접속할 지 모르는 상태에서 어떻게 이러한 고민을 하지 않을 수 있을까요?

이런 고민들을 하지 않기 위해서 우리는 babel 과 같은 도구들을 사용하여 polyfill 을 채워넣어 빌드를 하게 되었고 그 덕분에 별다른 작업 없이 최신 문법들과 도구들을 사용하면서도 다양한 브라우저를 지원할 수 있습니다. 

![es6+ compatibility](/images/vue-nuxt-modern-mode/es-compatibility.png)
~~이런 표를 매번 체크하면서 개발 할 수는 없습니다...~~

그런데 과연 이게 장점만 있을까요?

하위 호환성을 위해 polyfill 을 채워넣는다는것은 결국 성능의 저하와 사용자 경험의 악화를 의미한다고 볼 수 있습니다.

polyfill 로 인해 삽입되는 코드들은 종종 기존 코드들 보다 장황하고 실행 속도가 느립니다.

이러한 polyfill 에 대한 제 소감은 마치 이렇습니다.

```
교수 : 왜 다시들어오지?
란초 : 뭘놓고가서요
교수 : 뭔데?
란초 : 기록되고, 분석되고, 요약되고, 정리된정보를 설명하고논의하는, 그림이첨부되기도하고 안되기도한 딱딱한표지를씌운,
      커버는 있는것도있고 없는것도있는 머리말, 소개, 목차, 인덱스가 있고 인간지식을 높이고, 풍성하게하며,
      계몽시키기위해 만들어진 시각기관을 통해전달되는 어떤사람에겐 촉각기관을 통해전달되는 물건이요.
교수 : 그게뭐야?
란초 : 책이요

영화 세얼간이 中 
```

이미 상대방(클라어인트)가 알고 있는 문법을 설명하기 위해 장황하게 설명을 하게 되고 결국 전달해야 하는 코드의 양이 증가하게 됩니다.

사용자는 증가한 코드를 다운로드 받기 위해 조금이라도 더 오래 기다려야 하고 브라우저는 더 많은 코드를 해석하게 되는 미묘하게 먼 길을 돌아가게 되겠죠.

이 글을 작성하는 시점에도 대다수의 브라우저는 es module 을 비롯하여 최신 문법들을 적절히 지원하고 있습니다.

대부분의 클라이언트가 별도의 작업 없이 우리의 코드를 충분히 이해할 수 있고 우리가 더 나은 코드를 제공할 수 있음에도 불구하고 세련된 브라우저들에게 더 무겁고 덜 효율적인 코드를 제공하는건 즐겁지 않습니다.

다행히 이러한 문제를 해결하기 위해 Vue 와 Nuxt 는 modern mode 를 지원합니다.

vue 에서는 이렇게 사용할 수 있고
```shell
vue-cli-service build --modern
```

nuxt 에서는 이렇게 하거나...
```shell
nuxt build|start --modern=server
```

nuxt.config.js 파일에
```javascript
export default {
    modern: true,
}
```

이렇게 지정 함으로서 사용할 수 있습니다.

vue 는 이제 modern bundle 과 legacy bundle 을 분리하여 빌드하게 됩니다.

![vue modern build](/images/vue-nuxt-modern-mode/vue-build.png)

nuxt 도 빌드 화면에 Modern 이 추가 됩니다.


![vue modern build](/images/vue-nuxt-modern-mode/nuxt-build.png)

vue 의 빌드 결과를 보면 modern 과 legacy 의 용량이 상당히 차이나는것 을 알 수 있습니다.

vue cli 로 생성한 아무것도 없는 프로젝트 마저 이정도 차이가 나는데 우리가 전력을 다해야 해야 하는 실제 서비스에서는 더 큰 차이를 보여줄 것 입니다.

vue 에 modern 빌드를 추가하는 것 은 그렇게 큰 작업이 필요하지 않으면서도 여러 이점을 가져다 줍니다.

만일 오늘 조금 여유가 있다면 서비스에 도입 해보는것도 좋은 경험일 거라 생각됩니다.

[Vue modern mode document](https://cli.vuejs.org/guide/browser-compatibility.html#modern-mode)

